<form id="guideForm">
  <label>Title (optional)<br><input name="title" placeholder="Weekend packing list"></label><br>
  <label>Prompt (required)<br><textarea name="prompt" required placeholder="Make a 3-day Nashville trip guideâ€¦"></textarea></label><br>
  <label>Skill<br>
    <select name="skill">
      <option>beginner</option>
      <option>intermediate</option>
      <option>advanced</option>
    </select>
  </label><br>
  <button type="submit">Save submission</button>
  <span data-status style="margin-left:.5rem;"></span>
</form>
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  // your real values (these are fine to expose for anon usage)
  const SUPABASE_URL = 'https://sndwrjoxeosocpjprzwm.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNuZHdyam94ZW9zb2NwanByendtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNzM0NTIsImV4cCI6MjA3Mjc0OTQ1Mn0.hPCMan3N-TDDzdKlSDTVoPhUqZNFlCUmpRzOVzsU2yI';

  // force the `app` schema in TWO ways (belt + suspenders)
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { db: { schema: 'app' } });
  const db = supabase.schema('app');

  const form = document.getElementById('guideForm');
  const statusEl = form.querySelector('[data-status]');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    const title  = String(fd.get('title')  || '');
    const prompt = String(fd.get('prompt') || '');
    const skill  = String(fd.get('skill')  || 'beginner');

    statusEl.textContent = 'Savingâ€¦';

    try {
      // ğŸš« do NOT call .select() here â€” anon doesn't have SELECT permission
      const { error, status } = await db
        .from('guide_submissions')
        .insert([{ title, prompt, meta: { source: 'aipassfast', skill } }]);

      if (error) throw error;
      form.reset();
      statusEl.textContent = (status === 201 ? 'Saved âœ…' : 'Saved âœ…');
    } catch (err) {
      console.error('Insert failed:', err);
      statusEl.textContent = 'Save failed âŒ';
      alert((err && err.message) ? err.message : String(err));
    }
  });
</script>
